(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class r{constructor(){this.isRunning=!1,this.isPaused=!1,this.isWorkSession=!0,this.timeRemaining=90*60,this.totalSessionTime=90*60,this.sessionCount=0,this.eyeRestInterval=null,this.eyeRestActive=!1,this.eyeRestCountdown=20,this.settings={workDuration:90,breakDuration:20,soundEnabled:!0,notificationsEnabled:!0},this.audioContext=null,this.mainTimer=null,this.eyeRestTimer=null,this.nextEyeRestTimeout=null,this.init()}init(){this.loadSettings(),this.initializeAds(),setTimeout(()=>{this.bindEvents()},50),this.updateDisplay(),this.scheduleNextEyeRest(),this.requestNotificationPermission()}initializeAds(){setTimeout(()=>{try{(adsbygoogle=window.adsbygoogle||[]).push({}),(adsbygoogle=window.adsbygoogle||[]).push({}),console.log("AdSense ads initialized")}catch{console.log("AdSense not available or blocked")}},1e3)}loadSettings(){const t=localStorage.getItem("focusClockSettings");t&&(this.settings={...this.settings,...JSON.parse(t)}),this.applySettings()}saveSettings(){localStorage.setItem("focusClockSettings",JSON.stringify(this.settings))}applySettings(){document.getElementById("soundEnabled").checked=this.settings.soundEnabled,document.getElementById("notificationsEnabled").checked=this.settings.notificationsEnabled,document.getElementById("workDuration").value=this.settings.workDuration,document.getElementById("breakDuration").value=this.settings.breakDuration,this.isRunning||(this.isWorkSession?(this.timeRemaining=this.settings.workDuration*60,this.totalSessionTime=this.settings.workDuration*60):(this.timeRemaining=this.settings.breakDuration*60,this.totalSessionTime=this.settings.breakDuration*60),this.updateDisplay())}bindEvents(){const t=(e,n,s)=>{const i=document.getElementById(e);return i?(i.addEventListener(n,s),console.log(`Event listener added for ${e}`),!0):(console.warn(`Element with ID '${e}' not found`),!1)};t("startPauseBtn","click",()=>this.toggleTimer()),t("resetBtn","click",()=>this.resetTimer()),t("settingsBtn","click",()=>this.openSettings()),t("instructionsHeader","click",()=>this.toggleInstructions()),t("toggleInstructions","click",e=>{e.stopPropagation(),this.toggleInstructions()}),t("closeSettings","click",e=>{e.preventDefault(),e.stopPropagation(),console.log("Close settings button clicked"),this.closeSettings()}),t("closeSettingsX","click",e=>{e.preventDefault(),e.stopPropagation(),console.log("Close settings X button clicked"),this.closeSettings()}),t("soundEnabled","change",e=>{this.settings.soundEnabled=e.target.checked,this.saveSettings()}),t("notificationsEnabled","change",e=>{this.settings.notificationsEnabled=e.target.checked,this.saveSettings()}),t("workDuration","change",e=>{this.settings.workDuration=parseInt(e.target.value),this.saveSettings(),this.applySettings()}),t("breakDuration","change",e=>{this.settings.breakDuration=parseInt(e.target.value),this.saveSettings(),this.applySettings()}),t("skipEyeRest","click",()=>this.skipEyeRest()),t("shareProgress","click",()=>this.toggleShareOptions()),t("shareTwitter","click",()=>this.shareToTwitter()),t("shareFacebook","click",()=>this.shareToFacebook()),t("shareLinkedIn","click",()=>this.shareToLinkedIn()),t("copyShareLink","click",()=>this.copyShareLink()),document.addEventListener("click",e=>{e.target.classList.contains("modal")&&!e.target.closest(".modal-content")&&e.target.classList.add("hidden")}),document.addEventListener("keydown",e=>{e.code==="Space"&&!e.target.matches("input, select, button")?(e.preventDefault(),this.toggleTimer()):e.code==="Escape"&&this.closeAllModals()})}toggleTimer(){this.isRunning?this.pauseTimer():this.startTimer()}startTimer(){this.isRunning=!0,this.isPaused=!1,document.getElementById("startPauseBtn").textContent="暫停",document.querySelector(".timer-circle").classList.add("active"),this.mainTimer=setInterval(()=>{this.timeRemaining--,this.updateDisplay(),this.timeRemaining<=0&&this.completeSession()},1e3),this.isWorkSession&&this.scheduleNextEyeRest()}pauseTimer(){this.isRunning=!1,this.isPaused=!0,document.getElementById("startPauseBtn").textContent="繼續",document.querySelector(".timer-circle").classList.remove("active"),this.mainTimer&&(clearInterval(this.mainTimer),this.mainTimer=null),this.nextEyeRestTimeout&&(clearTimeout(this.nextEyeRestTimeout),this.nextEyeRestTimeout=null)}resetTimer(){this.isRunning=!1,this.isPaused=!1,this.mainTimer&&(clearInterval(this.mainTimer),this.mainTimer=null),this.nextEyeRestTimeout&&(clearTimeout(this.nextEyeRestTimeout),this.nextEyeRestTimeout=null),this.isWorkSession?(this.timeRemaining=this.settings.workDuration*60,this.totalSessionTime=this.settings.workDuration*60):(this.timeRemaining=this.settings.breakDuration*60,this.totalSessionTime=this.settings.breakDuration*60),document.getElementById("startPauseBtn").textContent="開始",document.querySelector(".timer-circle").classList.remove("active"),this.updateDisplay()}completeSession(){this.isRunning=!1,this.mainTimer&&(clearInterval(this.mainTimer),this.mainTimer=null),this.isWorkSession?(this.sessionCount++,this.isWorkSession=!1,this.timeRemaining=this.settings.breakDuration*60,this.totalSessionTime=this.settings.breakDuration*60,this.showNotification("工作時間結束！","時間休息一下吧 🎉"),this.playNotificationSound()):(this.isWorkSession=!0,this.timeRemaining=this.settings.workDuration*60,this.totalSessionTime=this.settings.workDuration*60,this.showNotification("休息結束！","準備開始新的工作週期 💪"),this.playNotificationSound()),document.getElementById("startPauseBtn").textContent="開始",document.querySelector(".timer-circle").classList.remove("active"),this.updateDisplay(),this.updateProgress()}scheduleNextEyeRest(){if(!this.isWorkSession||!this.isRunning)return;const t=Math.floor(Math.random()*121)+180;this.nextEyeRestTimeout=setTimeout(()=>{this.isRunning&&this.isWorkSession&&this.showEyeRest()},t*1e3)}showEyeRest(){this.eyeRestActive||(this.eyeRestActive=!0,this.eyeRestCountdown=20,document.getElementById("eyeRestModal").classList.remove("hidden"),document.getElementById("eyeRestCountdown").textContent=this.eyeRestCountdown,this.playNotificationSound(),this.showNotification("護眼休息時間！","請閉上眼睛休息 20 秒 👁️"),this.eyeRestTimer=setInterval(()=>{this.eyeRestCountdown--,document.getElementById("eyeRestCountdown").textContent=this.eyeRestCountdown,this.eyeRestCountdown<=0&&this.endEyeRest()},1e3))}endEyeRest(){this.eyeRestActive=!1,this.eyeRestTimer&&(clearInterval(this.eyeRestTimer),this.eyeRestTimer=null),document.getElementById("eyeRestModal").classList.add("hidden"),this.scheduleNextEyeRest()}skipEyeRest(){this.endEyeRest()}updateDisplay(){const t=Math.floor(this.timeRemaining/60),e=this.timeRemaining%60,n=`${t}:${e.toString().padStart(2,"0")}`;document.getElementById("timeDisplay").textContent=n;const s=this.isWorkSession?"專注時間":"休息時間",i=this.isRunning?this.isWorkSession?"工作中":"休息中":"準備中";document.getElementById("sessionType").textContent=s,document.getElementById("phaseDisplay").textContent=i;const o=document.getElementById("sessionType");o.style.background=this.isWorkSession?"var(--primary-color)":"var(--secondary-color)",document.title=`${n} - ${s} - 專注時鐘`}updateProgress(){document.getElementById("completedSessions").textContent=this.sessionCount;const e=Math.min(this.sessionCount/4*100,100);document.getElementById("progressFill").style.width=`${e}%`}openSettings(){document.getElementById("settingsModal").classList.remove("hidden")}closeSettings(){console.log("closeSettings method called");const t=document.getElementById("settingsModal");t?(t.classList.add("hidden"),console.log("Settings modal closed successfully")):console.error("Settings modal not found!")}closeAllModals(){document.querySelectorAll(".modal").forEach(t=>{t.classList.add("hidden")})}async requestNotificationPermission(){"Notification"in window&&this.settings.notificationsEnabled&&Notification.permission==="default"&&await Notification.requestPermission()}showNotification(t,e){this.settings.notificationsEnabled&&"Notification"in window&&Notification.permission==="granted"&&new Notification(t,{body:e,icon:"/clock.svg",tag:"focus-clock"})}async playNotificationSound(){if(this.settings.soundEnabled)try{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext));const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination),t.frequency.setValueAtTime(520,this.audioContext.currentTime),e.gain.setValueAtTime(.05,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.005,this.audioContext.currentTime+.8),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+.8)}catch(t){console.log("Audio not available:",t)}}toggleInstructions(){const t=document.getElementById("instructionsContent"),e=document.getElementById("toggleInstructions");t.classList.contains("expanded")?(t.classList.remove("expanded"),e.textContent="展開"):(t.classList.add("expanded"),e.textContent="收起")}toggleShareOptions(){const t=document.getElementById("shareOptions");t&&t.classList.toggle("hidden")}generateShareText(){const t=this.sessionCount,e=t*this.settings.workDuration,n=Math.floor(e/60),s=e%60;let i="";n>0?i=`${n}小時${s>0?s+"分鐘":""}`:i=`${s}分鐘`;const o=[`今天我用專注時鐘完成了 ${t} 個工作週期，總共專注了 ${i}！💪`,`🎯 專注打卡！今日已完成 ${t} 個90分鐘專注週期，累積專注時間 ${i} 📚`,`⏰ 專注時鐘幫我今天保持專注 ${i}，完成了 ${t} 個工作週期！效率滿分 🔥`,`💡 今日專注成果：${t} 個工作週期 | ${i} 專注時間 | 專注時鐘讓我更高效！✨`];return o[Math.floor(Math.random()*o.length)]}shareToTwitter(){const t=this.generateShareText(),e=window.location.href,n=`https://twitter.com/intent/tweet?text=${encodeURIComponent(t)}&url=${encodeURIComponent(e)}&hashtags=專注時鐘,番茄鐘,專注,效率`;window.open(n,"_blank","width=550,height=420"),this.toggleShareOptions()}shareToFacebook(){const t=window.location.href,e=this.generateShareText(),n=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(t)}&quote=${encodeURIComponent(e)}`;window.open(n,"_blank","width=600,height=400"),this.toggleShareOptions()}shareToLinkedIn(){const t=this.generateShareText(),e=window.location.href,n=`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(e)}&summary=${encodeURIComponent(t)}`;window.open(n,"_blank","width=600,height=400"),this.toggleShareOptions()}async copyShareLink(){const t=this.generateShareText(),e=window.location.href,n=`${t}

🔗 ${e}`;try{await navigator.clipboard.writeText(n);const s=document.getElementById("copyShareLink"),i=s.innerHTML;s.innerHTML='<span class="share-platform-icon">✅</span>已複製',s.style.background="var(--secondary-color)",setTimeout(()=>{s.innerHTML=i,s.style.background=""},2e3)}catch{const i=document.createElement("textarea");i.value=n,document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i),alert("分享內容已複製到剪貼板！")}this.toggleShareOptions()}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, initializing FocusClock..."),setTimeout(()=>{const a=new r;window.app=a,console.log("FocusClock initialized successfully")},100),window.closeSettingsModal=function(){console.log("Global close function called");const a=document.getElementById("settingsModal");a&&(a.classList.add("hidden"),a.style.display="none",console.log("Modal closed via global function"))}});"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").catch(console.error);
