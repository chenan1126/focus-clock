(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class h{constructor(){this.isRunning=!1,this.isPaused=!1,this.isWorkSession=!0,this.timeRemaining=90*60,this.totalSessionTime=90*60,this.sessionCount=0,this.eyeRestInterval=null,this.eyeRestActive=!1,this.eyeRestCountdown=20,this.settings={workDuration:90,breakDuration:20,soundEnabled:!0,notificationsEnabled:!0},this.audioContext=null,this.mainTimer=null,this.eyeRestTimer=null,this.nextEyeRestTimeout=null,this.init()}init(){this.loadSettings(),this.initializeAds(),setTimeout(()=>{this.bindEvents()},50),this.updateDisplay(),this.scheduleNextEyeRest(),this.requestNotificationPermission()}initializeAds(){setTimeout(()=>{try{(adsbygoogle=window.adsbygoogle||[]).push({}),(adsbygoogle=window.adsbygoogle||[]).push({}),console.log("AdSense ads initialized")}catch{console.log("AdSense not available or blocked")}},1e3)}loadSettings(){const e=localStorage.getItem("focusClockSettings");e&&(this.settings={...this.settings,...JSON.parse(e)}),this.applySettings()}saveSettings(){localStorage.setItem("focusClockSettings",JSON.stringify(this.settings))}applySettings(){document.getElementById("soundEnabled").checked=this.settings.soundEnabled,document.getElementById("notificationsEnabled").checked=this.settings.notificationsEnabled,document.getElementById("workDuration").value=this.settings.workDuration,document.getElementById("breakDuration").value=this.settings.breakDuration,this.isRunning||(this.isWorkSession?(this.timeRemaining=this.settings.workDuration*60,this.totalSessionTime=this.settings.workDuration*60):(this.timeRemaining=this.settings.breakDuration*60,this.totalSessionTime=this.settings.breakDuration*60),this.updateDisplay())}bindEvents(){const e=(t,n,s)=>{const i=document.getElementById(t);return i?(i.addEventListener(n,s),console.log(`Event listener added for ${t}`),!0):(console.warn(`Element with ID '${t}' not found`),!1)};e("startPauseBtn","click",()=>this.toggleTimer()),e("resetBtn","click",()=>this.resetTimer()),e("settingsBtn","click",()=>this.openSettings()),e("instructionsHeader","click",()=>this.toggleInstructions()),e("toggleInstructions","click",t=>{t.stopPropagation(),this.toggleInstructions()}),e("closeSettings","click",t=>{t.preventDefault(),t.stopPropagation(),console.log("Close settings button clicked"),this.closeSettings()}),e("closeSettingsX","click",t=>{t.preventDefault(),t.stopPropagation(),console.log("Close settings X button clicked"),this.closeSettings()}),e("soundEnabled","change",t=>{this.settings.soundEnabled=t.target.checked,this.saveSettings()}),e("notificationsEnabled","change",t=>{this.settings.notificationsEnabled=t.target.checked,this.saveSettings()}),e("workDuration","change",t=>{this.settings.workDuration=parseInt(t.target.value),this.saveSettings(),this.applySettings()}),e("breakDuration","change",t=>{this.settings.breakDuration=parseInt(t.target.value),this.saveSettings(),this.applySettings()}),e("skipEyeRest","click",()=>this.skipEyeRest()),e("shareProgress","click",()=>this.toggleShareOptions()),e("generateStoryImage","click",()=>this.generateStoryImage()),e("shareTwitter","click",()=>this.shareToTwitter()),e("shareFacebook","click",()=>this.shareToFacebook()),e("shareLinkedIn","click",()=>this.shareToLinkedIn()),e("copyShareLink","click",()=>this.copyShareLink()),e("closeImagePreview","click",()=>this.closeImagePreview()),e("downloadImage","click",()=>this.downloadImage()),e("shareImage","click",()=>this.shareGeneratedImage()),document.addEventListener("click",t=>{t.target.classList.contains("modal")&&!t.target.closest(".modal-content")&&t.target.classList.add("hidden")}),document.addEventListener("keydown",t=>{t.code==="Space"&&!t.target.matches("input, select, button")?(t.preventDefault(),this.toggleTimer()):t.code==="Escape"&&this.closeAllModals()})}toggleTimer(){this.isRunning?this.pauseTimer():this.startTimer()}startTimer(){this.isRunning=!0,this.isPaused=!1,document.getElementById("startPauseBtn").textContent="æš«åœ",document.querySelector(".timer-circle").classList.add("active"),this.mainTimer=setInterval(()=>{this.timeRemaining--,this.updateDisplay(),this.timeRemaining<=0&&this.completeSession()},1e3),this.isWorkSession&&this.scheduleNextEyeRest()}pauseTimer(){this.isRunning=!1,this.isPaused=!0,document.getElementById("startPauseBtn").textContent="ç¹¼çºŒ",document.querySelector(".timer-circle").classList.remove("active"),this.mainTimer&&(clearInterval(this.mainTimer),this.mainTimer=null),this.nextEyeRestTimeout&&(clearTimeout(this.nextEyeRestTimeout),this.nextEyeRestTimeout=null)}resetTimer(){this.isRunning=!1,this.isPaused=!1,this.mainTimer&&(clearInterval(this.mainTimer),this.mainTimer=null),this.nextEyeRestTimeout&&(clearTimeout(this.nextEyeRestTimeout),this.nextEyeRestTimeout=null),this.isWorkSession?(this.timeRemaining=this.settings.workDuration*60,this.totalSessionTime=this.settings.workDuration*60):(this.timeRemaining=this.settings.breakDuration*60,this.totalSessionTime=this.settings.breakDuration*60),document.getElementById("startPauseBtn").textContent="é–‹å§‹",document.querySelector(".timer-circle").classList.remove("active"),this.updateDisplay()}completeSession(){this.isRunning=!1,this.mainTimer&&(clearInterval(this.mainTimer),this.mainTimer=null),this.isWorkSession?(this.sessionCount++,this.isWorkSession=!1,this.timeRemaining=this.settings.breakDuration*60,this.totalSessionTime=this.settings.breakDuration*60,this.showNotification("å·¥ä½œæ™‚é–“çµæŸï¼","æ™‚é–“ä¼‘æ¯ä¸€ä¸‹å§ ğŸ‰"),this.playNotificationSound()):(this.isWorkSession=!0,this.timeRemaining=this.settings.workDuration*60,this.totalSessionTime=this.settings.workDuration*60,this.showNotification("ä¼‘æ¯çµæŸï¼","æº–å‚™é–‹å§‹æ–°çš„å·¥ä½œé€±æœŸ ğŸ’ª"),this.playNotificationSound()),document.getElementById("startPauseBtn").textContent="é–‹å§‹",document.querySelector(".timer-circle").classList.remove("active"),this.updateDisplay(),this.updateProgress()}scheduleNextEyeRest(){if(!this.isWorkSession||!this.isRunning)return;const e=Math.floor(Math.random()*121)+180;this.nextEyeRestTimeout=setTimeout(()=>{this.isRunning&&this.isWorkSession&&this.showEyeRest()},e*1e3)}showEyeRest(){this.eyeRestActive||(this.eyeRestActive=!0,this.eyeRestCountdown=20,document.getElementById("eyeRestModal").classList.remove("hidden"),document.getElementById("eyeRestCountdown").textContent=this.eyeRestCountdown,this.playNotificationSound(),this.showNotification("è­·çœ¼ä¼‘æ¯æ™‚é–“ï¼","è«‹é–‰ä¸Šçœ¼ç›ä¼‘æ¯ 20 ç§’ ğŸ‘ï¸"),this.eyeRestTimer=setInterval(()=>{this.eyeRestCountdown--,document.getElementById("eyeRestCountdown").textContent=this.eyeRestCountdown,this.eyeRestCountdown<=0&&this.endEyeRest()},1e3))}endEyeRest(){this.eyeRestActive=!1,this.eyeRestTimer&&(clearInterval(this.eyeRestTimer),this.eyeRestTimer=null),document.getElementById("eyeRestModal").classList.add("hidden"),this.scheduleNextEyeRest()}skipEyeRest(){this.endEyeRest()}updateDisplay(){const e=Math.floor(this.timeRemaining/60),t=this.timeRemaining%60,n=`${e}:${t.toString().padStart(2,"0")}`;document.getElementById("timeDisplay").textContent=n;const s=this.isWorkSession?"å°ˆæ³¨æ™‚é–“":"ä¼‘æ¯æ™‚é–“",i=this.isRunning?this.isWorkSession?"å·¥ä½œä¸­":"ä¼‘æ¯ä¸­":"æº–å‚™ä¸­";document.getElementById("sessionType").textContent=s,document.getElementById("phaseDisplay").textContent=i;const o=document.getElementById("sessionType");o.style.background=this.isWorkSession?"var(--primary-color)":"var(--secondary-color)",document.title=`${n} - ${s} - å°ˆæ³¨æ™‚é˜`}updateProgress(){document.getElementById("completedSessions").textContent=this.sessionCount;const t=Math.min(this.sessionCount/4*100,100);document.getElementById("progressFill").style.width=`${t}%`}openSettings(){document.getElementById("settingsModal").classList.remove("hidden")}closeSettings(){console.log("closeSettings method called");const e=document.getElementById("settingsModal");e?(e.classList.add("hidden"),console.log("Settings modal closed successfully")):console.error("Settings modal not found!")}closeAllModals(){document.querySelectorAll(".modal").forEach(e=>{e.classList.add("hidden")})}async requestNotificationPermission(){"Notification"in window&&this.settings.notificationsEnabled&&Notification.permission==="default"&&await Notification.requestPermission()}showNotification(e,t){this.settings.notificationsEnabled&&"Notification"in window&&Notification.permission==="granted"&&new Notification(e,{body:t,icon:"/clock.svg",tag:"focus-clock"})}async playNotificationSound(){if(this.settings.soundEnabled)try{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext));const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(520,this.audioContext.currentTime),t.gain.setValueAtTime(.05,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.005,this.audioContext.currentTime+.8),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+.8)}catch(e){console.log("Audio not available:",e)}}toggleInstructions(){const e=document.getElementById("instructionsContent"),t=document.getElementById("toggleInstructions");e.classList.contains("expanded")?(e.classList.remove("expanded"),t.textContent="å±•é–‹"):(e.classList.add("expanded"),t.textContent="æ”¶èµ·")}toggleShareOptions(){const e=document.getElementById("shareOptions");e&&e.classList.toggle("hidden")}generateShareText(){const e=this.sessionCount,t=e*this.settings.workDuration,n=Math.floor(t/60),s=t%60;let i="";n>0?i=`${n}å°æ™‚${s>0?s+"åˆ†é˜":""}`:i=`${s}åˆ†é˜`;const o=[`ä»Šå¤©æˆ‘ç”¨å°ˆæ³¨æ™‚é˜å®Œæˆäº† ${e} å€‹å·¥ä½œé€±æœŸï¼Œç¸½å…±å°ˆæ³¨äº† ${i}ï¼ğŸ’ª`,`ğŸ¯ å°ˆæ³¨æ‰“å¡ï¼ä»Šæ—¥å·²å®Œæˆ ${e} å€‹90åˆ†é˜å°ˆæ³¨é€±æœŸï¼Œç´¯ç©å°ˆæ³¨æ™‚é–“ ${i} ğŸ“š`,`â° å°ˆæ³¨æ™‚é˜å¹«æˆ‘ä»Šå¤©ä¿æŒå°ˆæ³¨ ${i}ï¼Œå®Œæˆäº† ${e} å€‹å·¥ä½œé€±æœŸï¼æ•ˆç‡æ»¿åˆ† ğŸ”¥`,`ğŸ’¡ ä»Šæ—¥å°ˆæ³¨æˆæœï¼š${e} å€‹å·¥ä½œé€±æœŸ | ${i} å°ˆæ³¨æ™‚é–“ | å°ˆæ³¨æ™‚é˜è®“æˆ‘æ›´é«˜æ•ˆï¼âœ¨`];return o[Math.floor(Math.random()*o.length)]}shareToTwitter(){const e=this.generateShareText(),t=window.location.href,n=`https://twitter.com/intent/tweet?text=${encodeURIComponent(e)}&url=${encodeURIComponent(t)}&hashtags=å°ˆæ³¨æ™‚é˜,ç•ªèŒ„é˜,å°ˆæ³¨,æ•ˆç‡`;window.open(n,"_blank","width=550,height=420"),this.toggleShareOptions()}shareToFacebook(){const e=window.location.href,t=this.generateShareText(),n=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(e)}&quote=${encodeURIComponent(t)}`;window.open(n,"_blank","width=600,height=400"),this.toggleShareOptions()}shareToLinkedIn(){const e=this.generateShareText(),t=window.location.href,n=`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(t)}&summary=${encodeURIComponent(e)}`;window.open(n,"_blank","width=600,height=400"),this.toggleShareOptions()}async copyShareLink(){const e=this.generateShareText(),t=window.location.href,n=`${e}

ğŸ”— ${t}`;try{await navigator.clipboard.writeText(n);const s=document.getElementById("copyShareLink"),i=s.innerHTML;s.innerHTML='<span class="share-platform-icon">âœ…</span>å·²è¤‡è£½',s.style.background="var(--secondary-color)",setTimeout(()=>{s.innerHTML=i,s.style.background=""},2e3)}catch{const i=document.createElement("textarea");i.value=n,document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i),alert("åˆ†äº«å…§å®¹å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼")}this.toggleShareOptions()}generateStoryImage(){const e=document.getElementById("hiddenCanvas"),t=e.getContext("2d");e.width=1080,e.height=1920;const n=t.createLinearGradient(0,0,0,e.height);n.addColorStop(0,"#667eea"),n.addColorStop(.5,"#764ba2"),n.addColorStop(1,"#f093fb"),t.fillStyle=n,t.fillRect(0,0,e.width,e.height),t.textAlign="center",t.fillStyle="#ffffff",t.font='bold 72px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.fillText("ğŸ¯ å°ˆæ³¨æ™‚é˜",e.width/2,200),t.font='48px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.fillStyle="#f0f0f0",t.fillText("Focus Clock",e.width/2,280);const s=this.sessionCount,i=s*90,o=Math.floor(i/60),l=i%60;t.font='bold 120px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.fillStyle="#ffd700",t.fillText(s.toString(),e.width/2,500),t.font='54px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.fillStyle="#ffffff",t.fillText("å€‹å°ˆæ³¨é€±æœŸå®Œæˆ",e.width/2,580),t.font='bold 84px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.fillStyle="#00ff88",o>0?t.fillText(`${o}å°æ™‚${l}åˆ†é˜`,e.width/2,720):t.fillText(`${l}åˆ†é˜`,e.width/2,720),t.font='54px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.fillStyle="#ffffff",t.fillText("å°ˆæ³¨æ™‚é–“",e.width/2,800);const c=new Date().toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"});t.font='42px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.fillStyle="#e0e0e0",t.fillText(c,e.width/2,920);const r=["å°ˆæ³¨åŠ›å°±æ˜¯è¶…èƒ½åŠ›ï¼ğŸ’ª","æ¯ä¸€åˆ†å°ˆæ³¨éƒ½åœ¨æ”¹è®Šä½ ï¼âš¡","æŒçºŒå°ˆæ³¨ï¼ŒæŒçºŒæˆé•·ï¼ğŸŒŸ","å°ˆæ³¨è®“æˆ‘æ›´å¼·å¤§ï¼ğŸš€","ä»Šå¤©åˆé€²æ­¥äº†ï¼âœ¨"],d=r[Math.floor(Math.random()*r.length)];t.font='48px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.fillStyle="#ffff88",t.fillText(d,e.width/2,1100),s>0&&(t.font='36px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.fillStyle="#88ffaa",t.fillText("âœ… å·²å®Œæˆå¤šæ¬¡è­·çœ¼ä¼‘æ¯",e.width/2,1200)),t.font='32px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.fillStyle="#cccccc",t.fillText("focusclock.app",e.width/2,1400),t.font='96px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.fillStyle="rgba(255, 255, 255, 0.3)",t.fillText("â°",e.width/2,1600),document.getElementById("storyCanvas").getContext("2d").drawImage(e,0,0),document.getElementById("imagePreviewModal").classList.remove("hidden")}closeImagePreview(){document.getElementById("imagePreviewModal").classList.add("hidden")}downloadImage(){const e=document.getElementById("hiddenCanvas"),t=document.createElement("a");t.download=`å°ˆæ³¨æ™‚é˜-${new Date().toLocaleDateString("zh-TW")}.png`,t.href=e.toDataURL("image/png"),t.click()}async shareGeneratedImage(){const e=document.getElementById("hiddenCanvas");if(navigator.share&&navigator.canShare)try{e.toBlob(async t=>{const n=new File([t],`å°ˆæ³¨æ™‚é˜-${new Date().toLocaleDateString("zh-TW")}.png`,{type:"image/png"});navigator.canShare({files:[n]})?await navigator.share({title:"æˆ‘çš„å°ˆæ³¨æ™‚é˜æˆæœ",text:`ä»Šå¤©å®Œæˆäº† ${this.sessionCount} å€‹å°ˆæ³¨é€±æœŸï¼`,files:[n]}):this.downloadImage()})}catch(t){console.error("åˆ†äº«å¤±æ•—:",t),this.downloadImage()}else this.downloadImage()}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, initializing FocusClock..."),setTimeout(()=>{const a=new h;window.app=a,console.log("FocusClock initialized successfully")},100),window.closeSettingsModal=function(){console.log("Global close function called");const a=document.getElementById("settingsModal");a&&(a.classList.add("hidden"),a.style.display="none",console.log("Modal closed via global function"))}});"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").catch(console.error);
